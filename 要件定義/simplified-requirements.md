# 盛土施工シミュレーション 簡易版要件定義書

## 1. プロジェクト概要

### 1.1 目的
Three.js を使用したウェブアプリケーションで、盛土施工の基本的なシミュレーションを行うシステムを開発する。地形上に盛土の完成形状（台形）を表現し、クリックによるボクセル単位での盛土施工をシミュレーションすることを目的とする。

### 1.2 背景
盛土工事の施工計画検討には、完成形だけでなく施工過程のシミュレーションが重要である。現場担当者が直感的に操作できるシンプルなツールが求められている。

## 2. 機能要件

### 2.1 基本機能

1. **Three.js によるウェブアプリケーション**
   - ウェブブラウザで動作する3Dアプリケーション
   - Three.js を使用した3D描画

2. **地形表現**
   - 平面としての基本地形の表示
   - 地形は単純な平面として表現（初期バージョンでは起伏なし）

3. **完成形状（台形）の表現**
   - 盛土の完成形状をピラミッド型台形として表示
   - 台形のパラメータ（高さ、上辺長、下辺長）を設定可能

4. **ボクセルによる盛土表現**
   - 盛土をボクセル単位で表現
   - デフォルトは5m四方であるが、厚みを変更することができる0.5m〜5.0m
   - 1日の計画土量に相当するボクセル数を算出

5. **シミュレーション機能**
   - 台形データ内のクリックした場所にボクセルを配置
   - 1日単位での盛土施工シミュレーション
   - 配置されたボクセルは台形データの外に出ない制約

6. **ボクセル配置方法の選択**
   - 平面配置モード（水平に広げる）
   - ピラミッド型台形配置モード（台形に沿って積み上げる）

## 3. 操作要件

### 3.1 基本操作

1. **3D表示操作**
   - マウスでの視点回転・拡大縮小・移動
   - 標準的な3D操作（OrbitControls等の利用）
   - xyz座標がわかるようにする。z方向が上向とする
   - 

2. **パラメータ設定**
   - 台形パラメータの入力
   - 1日あたりの盛土量（ボクセル数）の設定

3. **施工シミュレーション操作**
   - 配置開始位置のクリック指定
   - 配置方法（平面/台形）の選択
   - 施工ステップの進行操作

## 4. 技術要件

### 4.1 開発環境

1. **フロントエンド**
   - HTML/CSS/JavaScript
   - Three.js ライブラリ（最新の安定版）
   - モジュールバンドラー（webpack, Vite等）の使用

2. **動作環境**
   - モダンウェブブラウザ（Chrome, Firefox, Edge等の最新版）
   - WebGL対応環境

### 4.2 実装要件

1. **3D表現**
   - 地形：平面メッシュで表現
   - 台形：基本的なジオメトリで表現
   - ボクセル：立方体メッシュの集合で表現

2. **ロジック**
   - ボクセル配置の境界チェック（台形内部のみに配置）
   - 1日あたりのボクセル数計算ロジック
   - 配置パターン（平面/台形）に応じた配置ロジック

3. **パフォーマンス**
   - 最大10,000個程度のボクセル表示に対応
   - フレームレートの最適化

## 5. 画面設計

### 5.1 メイン3D表示画面

1. **表示要素**
   - 地形（平面）
   - 盛土完成形状（台形）
   - 配置済みボクセル
   - 配置予定ボクセル（プレビュー）
   - xyz方向の把握

2. **操作UI**
   - カメラコントロール
   - 施工ステップ進行ボタン
   - 配置方法切替ボタン

### 5.2 パラメータ設定パネル

1. **入力項目**
   - 台形パラメータ（高さ、上辺長、下辺長、奥行き）
   - 1日あたりの盛土量（m³）
   - ボクセルサイズ（デフォルト: 5m×5m×5m）

2. **表示項目**
   - 経過日数
   - 配置済みボクセル数
   - 残りのボクセル数

## 6. 動作フロー

1. **初期表示**
   - 地形（平面）の表示
   - デフォルトパラメータでの台形表示

2. **設定操作**
   - 台形パラメータの設定
   - 1日あたりの盛土量の設定

3. **シミュレーション実行**
   - 配置方法の選択（平面/台形）
   - クリックによる配置開始位置の指定
   - 1日分のボクセルが自動配置される
   - 次のステップへ進行

4. **結果確認**
   - 経過日数の確認
   - 配置済みボクセルの確認
   - 必要に応じて視点を変更して確認

## 7. 制約・前提条件

1. **簡易シミュレーション**
   - 地形は平面のみ（複雑な起伏は非対応）
   - 盛土形状は単一の台形のみ
   - ボクセルサイズは固定（5m×5m×5m）

2. **処理の簡略化**
   - 物理シミュレーションは行わない
   - 施工過程の最適化機能は含まない

3. **将来拡張可能性**
   - 後続フェーズでの機能追加を考慮した設計
   - モジュール化された実装

## 8. 開発スケジュール

1. **フェーズ1: 基本機能実装**
   - 3D表示環境構築
   - 地形と台形の表示機能
   - ボクセル配置の基本機能

2. **フェーズ2: 操作性向上**
   - UI/UXの改善
   - ビジュアル表現の向上
   - フィードバック機能の追加

## 9. 成功基準

1. ウェブブラウザで問題なく動作すること
2. クリックした場所に正確にボクセルが配置されること
3. 台形の外にボクセルがはみ出さないこと
4. 2種類の配置方法（平面/台形）で正しくボクセルが配置されること
5. 操作がシンプルで直感的であること


- ボクセルは、z=0を基準面として、下から積み上がるように配置したい。なお、配置済みのボクセルとは干渉してはならない。
- ボクセルのz方向の高さのみ変更するようにしたい。0.5m〜2mを0.1mピッチで変更できるようにしたい
- ボクセル追加は左クリックで追加されますが、左のダブルクリックで追加されるようにしたい